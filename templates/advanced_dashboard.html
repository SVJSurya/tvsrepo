<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMI VoiceBot - Advanced Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
        }

        .main-content {
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2a5298;
            margin-bottom: 5px;
        }

        .header p {
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .stat-change.positive {
            color: #28a745;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .activity-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .activity-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .live-calls {
            max-height: 400px;
            overflow-y: auto;
        }

        .call-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .call-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .call-status.calling {
            background: #ffc107;
            animation: pulse 1s infinite;
        }

        .call-status.connected {
            background: #28a745;
        }

        .call-status.completed {
            background: #6c757d;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .action-btn i {
            margin-right: 8px;
        }

        .activity-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .demo-progress {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .progress-bar {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.5s ease;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .activity-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                ðŸš€ EMI VoiceBot
            </div>
            <nav>
                <a href="#" class="nav-item active" data-section="overview">
                    <i class="fas fa-tachometer-alt"></i>
                    Overview
                </a>
                <a href="#" class="nav-item" data-section="calls">
                    <i class="fas fa-phone"></i>
                    Live Calls
                </a>
                <a href="/reports" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    Analytics
                </a>
                <a href="/customers" class="nav-item">
                    <i class="fas fa-users"></i>
                    Customers
                </a>
                <a href="#" class="nav-item" data-section="payments">
                    <i class="fas fa-credit-card"></i>
                    Payments
                </a>
                <a href="#" class="nav-item" data-section="demo">
                    <i class="fas fa-play"></i>
                    Live Demo
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>AI-Powered EMI Collection Dashboard</h1>
                <p>Real-time monitoring and control of automated EMI collection system</p>
            </div>

            <!-- Overview Section -->
            <div id="overview-section">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="color: #667eea;">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <div class="stat-value" id="calls-today">0</div>
                        <div class="stat-label">Calls Today</div>
                        <div class="stat-change positive">+12% from yesterday</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: #28a745;">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Success Rate</div>
                        <div class="stat-change positive">+5.2% this week</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: #ffc107;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-value" id="due-emis">0</div>
                        <div class="stat-label">Due EMIs</div>
                        <div class="stat-change negative">-8% from last week</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: #17a2b8;">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-value" id="collections">â‚¹0</div>
                        <div class="stat-label">Collections</div>
                        <div class="stat-change positive">+18% this month</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="action-btn" onclick="triggerCalls()">
                        <i class="fas fa-search"></i>
                        Check Due EMIs
                    </button>
                    <button class="action-btn" onclick="startLiveDemo()">
                        <i class="fas fa-play"></i>
                        Start Live Demo
                    </button>
                    <button class="action-btn" onclick="window.open('/live-demo', '_blank')">
                        <i class="fas fa-phone-alt"></i>
                        Live Call Demo
                    </button>
                    <button class="action-btn" onclick="window.open('/voice-demo', '_blank')">
                        <i class="fas fa-microphone"></i>
                        Voice Demo
                    </button>
                    <button class="action-btn" onclick="window.open('/realtime-demo', '_blank')">
                        <i class="fas fa-video"></i>
                        Real-Time Demo
                    </button>
                    <button class="action-btn" onclick="viewAnalytics()">
                        <i class="fas fa-chart-bar"></i>
                        View Analytics
                    </button>
                    <button class="action-btn" onclick="testCall()">
                        <i class="fas fa-phone"></i>
                        Test Voice Call
                    </button>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title">Call Performance Trends</div>
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">Collection Distribution</div>
                        <canvas id="collectionChart" width="200" height="200"></canvas>
                    </div>
                </div>

                <!-- Activity Section -->
                <div class="activity-section">
                    <div class="activity-card">
                        <div class="chart-title">Live Call Activity</div>
                        <div class="live-calls" id="live-calls">
                            <!-- Live calls will be populated here -->
                        </div>
                    </div>
                    
                    <div class="activity-card">
                        <div class="chart-title">Recent Payments</div>
                        <div id="recent-payments">
                            <!-- Recent payments will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="activity-card">
                    <div class="chart-title">System Activity Log</div>
                    <div class="activity-log" id="activity-log">
                        <div class="log-entry">[12:45:23] System initialized and ready</div>
                    </div>
                </div>
            </div>

            <!-- Demo Section -->
            <div id="demo-section" class="hidden">
                <div class="activity-card">
                    <div class="chart-title">Live Workflow Demo</div>
                    <div class="demo-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="demo-progress" style="width: 0%;"></div>
                        </div>
                        <div id="demo-status">Ready to start demo</div>
                    </div>
                    <button class="action-btn" onclick="runWorkflowDemo()" style="margin-top: 20px;">
                        <i class="fas fa-rocket"></i>
                        Start Complete Workflow Demo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo Modal -->
    <div id="demoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDemoModal()">&times;</span>
            <h2>ðŸŽ­ Live Demo in Progress</h2>
            <div id="demo-steps"></div>
        </div>
    </div>

    <script>
        // Global variables
        let performanceChart, collectionChart;
        let demoProgress = 0;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateStats();
            setupNavigation();
            startRealtimeUpdates();
        });

        // Chart initialization
        function initializeCharts() {
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Calls Made',
                        data: [120, 190, 300, 500, 200, 300, 450],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Successful Calls',
                        data: [100, 150, 250, 420, 180, 270, 380],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Collection Chart
            const collCtx = document.getElementById('collectionChart').getContext('2d');
            collectionChart = new Chart(collCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Collected', 'Pending', 'Overdue'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Navigation setup
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all items
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Show/hide sections
                    const section = this.dataset.section;
                    showSection(section);
                });
            });
        }

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(sec => sec.classList.add('hidden'));
            
            // Show selected section
            const targetSection = document.getElementById(section + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
        }

        // API functions
        async function updateStats() {
            try {
                const response = await axios.get('/api/stats');
                const data = response.data;
                
                document.getElementById('calls-today').textContent = data.calls_today || 0;
                document.getElementById('success-rate').textContent = ((data.success_rate || 0) * 100).toFixed(1) + '%';
                document.getElementById('due-emis').textContent = data.due_emis || 0;
                document.getElementById('collections').textContent = 'â‚¹' + ((data.collections || 0) / 1000).toFixed(1) + 'K';
            } catch (error) {
                console.error('Error updating stats:', error);
                addLogEntry('âŒ Error fetching stats: ' + error.message);
            }
        }

        async function triggerCalls() {
            addLogEntry('ðŸ” Checking for due EMIs...');
            try {
                const response = await axios.post('/api/trigger/check-due-emis');
                const data = response.data;
                addLogEntry(`âœ… Found ${data.due_emis.length} customers requiring calls`);
                updateStats();
                updateLiveCalls(data.due_emis);
            } catch (error) {
                addLogEntry('âŒ Error checking due EMIs: ' + error.message);
            }
        }

        async function startLiveDemo() {
            showSection('demo');
            addLogEntry('ðŸŽ­ Starting live workflow demo...');
        }

        async function viewAnalytics() {
            addLogEntry('ðŸ“ˆ Generating analytics report...');
            try {
                const response = await axios.get('/api/analytics/dashboard');
                const data = response.data;
                addLogEntry(`ðŸ“Š Analytics: ${data.interaction_analytics.total_interactions} interactions, ${(data.interaction_analytics.success_rate * 100).toFixed(1)}% success rate`);
            } catch (error) {
                addLogEntry('âŒ Error fetching analytics: ' + error.message);
            }
        }

        async function testCall() {
            addLogEntry('ðŸ“ž Initiating test voice call...');
            try {
                const response = await axios.post('/api/voice/test-call');
                const data = response.data;
                addLogEntry(`ðŸ“ž Test call status: ${data.test_result.status}`);
            } catch (error) {
                addLogEntry('âŒ Error testing call: ' + error.message);
            }
        }

        // Demo functions
        function runWorkflowDemo() {
            const modal = document.getElementById('demoModal');
            modal.style.display = 'block';
            
            const steps = [
                'Initializing AI agents...',
                'Scanning database for due EMIs...',
                'Analyzing customer risk profiles...',
                'Initiating AI voice calls...',
                'Processing customer responses...',
                'Making intelligent decisions...',
                'Generating payment links...',
                'Updating analytics and learning models...',
                'Demo completed successfully! ðŸŽ‰'
            ];
            
            const stepsContainer = document.getElementById('demo-steps');
            stepsContainer.innerHTML = '';
            
            demoProgress = 0;
            
            steps.forEach((step, index) => {
                setTimeout(() => {
                    const stepDiv = document.createElement('div');
                    stepDiv.style.padding = '10px';
                    stepDiv.style.marginBottom = '10px';
                    stepDiv.style.backgroundColor = '#f8f9fa';
                    stepDiv.style.borderRadius = '5px';
                    stepDiv.style.borderLeft = '4px solid #667eea';
                    stepDiv.textContent = `${index + 1}. ${step}`;
                    stepsContainer.appendChild(stepDiv);
                    
                    demoProgress = ((index + 1) / steps.length) * 100;
                    document.getElementById('demo-progress').style.width = demoProgress + '%';
                    document.getElementById('demo-status').textContent = step;
                    
                    addLogEntry(`[DEMO] ${step}`);
                    
                    if (index === steps.length - 1) {
                        setTimeout(() => {
                            closeDemoModal();
                        }, 2000);
                    }
                }, index * 1500);
            });
        }

        function closeDemoModal() {
            document.getElementById('demoModal').style.display = 'none';
        }

        // Utility functions
        function addLogEntry(message) {
            const log = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${timestamp}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }

        function updateLiveCalls(calls) {
            const container = document.getElementById('live-calls');
            container.innerHTML = '';
            
            calls.slice(0, 5).forEach((call, index) => {
                const callDiv = document.createElement('div');
                callDiv.className = 'call-item';
                
                const status = ['calling', 'connected', 'completed'][index % 3];
                
                callDiv.innerHTML = `
                    <div class="call-status ${status}"></div>
                    <div>
                        <strong>${call.customer_name || 'Customer ' + call.customer_id}</strong><br>
                        <small>EMI: â‚¹${call.loan_info?.emi_amount || 0} | Priority: ${call.priority}</small>
                    </div>
                `;
                
                container.appendChild(callDiv);
            });
        }

        // Real-time updates
        function startRealtimeUpdates() {
            setInterval(() => {
                updateStats();
            }, 30000); // Update every 30 seconds
            
            // Add random activity for demo
            setInterval(() => {
                const activities = [
                    'ðŸ“ž Call completed successfully',
                    'ðŸ’³ Payment link generated',
                    'ðŸ“Š Customer risk score updated',
                    'ðŸ¤– AI model learning from interaction',
                    'ðŸ“ˆ Analytics refreshed'
                ];
                
                const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                addLogEntry(randomActivity);
            }, 10000); // Add activity every 10 seconds
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('demoModal');
            if (event.target === modal) {
                closeDemoModal();
            }
        }
    </script>
</body>
</html>
